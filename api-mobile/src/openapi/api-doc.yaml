openapi: 3.0.0

info:
  version: 0.0.0
  title: invasivesbc-api-mobile
  description: API for InvasivesBC mobile.
  license:
    name: Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html

servers:
  - url: http://localhost:3002/api
    description: local api
  - url: http://localhost:7080/api
    description: local api via docker
  - url: https://api-mobile-dev-invasivesbc.pathfinder.gov.bc.ca
    description: deployed api in dev environment
  - url: https://api-mobile-test-invasivesbc.pathfinder.gov.bc.ca
    description: deployed api in test environment
  - url: https://api-mobile-invasivesbc.pathfinder.gov.bc.ca
    description: deployed api in prod environmen

tags:
  - name: misc
    description: Miscellaneous endpoints
  - name: activity
    description: |
      Activity endpoints
      An activity is a parent classification that contains Observations, Treatments, and Monitoring 'activities'
  - name: observation
    description: Observation activity endpoints
  - name: plant
    description: Plant endpoints
  - name: code
    description: Code endpoints
  - name: media
    description: Media endpoints

externalDocs:
  description: Visit GitHub to find out more about this API
  url: https://github.com/bcgov/lucy-web.git

## paths are generated via express-openapi based on the ./src/paths/* structure
paths: {}

# See https://github.com/OAI/OpenAPI-Specification/blob/master/versions/3.0.3.md#componentsObject for supported component types
components:
  securitySchemes:
    Bearer: # arbitrary name for the security scheme
      type: http
      scheme: bearer
      bearerFormat: JWT # optional, arbitrary value for documentation purposes
      description: |
        To access the authenticated api routes, a valid JWT token must be present in the 'Authorization' header.
        The 'Authorization' header value must be of the form: `Bearer xxxxxx.yyyyyyy.zzzzzz`

  responses:
    "401":
      description: Unauthorized user
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"

    "400":
      description: Bad request
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"

    "503":
      description: Service unavailable
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"

    default:
      description: Unexpected error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"

  schemas:
    Error:
      description: Error response object.
      properties:
        status:
          type: number
        message:
          type: string
        errors:
          type: array
          items:
            type: string

    Activity:
      description:
        Activity main object.
      type: object
      required:
        - species_agency_code
        - jurisdiction_code
        - activity_status
        - species_id
        - access_description
        - media_indicator
        - created_date_on_device
        - updated_date_on_device
        - geometry
        - subType
      properties:
        species_agency_code:
          type: string
          title: "Agency"
        jurisdiction_code:
          type: string
          title: "Jurisdiction"
        activity_status:
          type: string
          title: "Activity status"
          enum:
          - sync
          - done
          - pending
          - errors
        species_id:
          type: string
          title: "Species"
        general_comment:
          type: string
          title: "Comment"
          maximum: 300
        access_description:
          type: string
          title: "Access Description"
          maximum: 300
        media_indicator:
          type: boolean
          title: "Photo"
        created_date_on_device:
          type: string
          title: "Created date on device"
        updated_date_on_device:
          type: string
          title: "Updated date on device"
        media:
          type: array
          title: "Photos"
          items:
            $ref: "#/components/schemas/Media"
        paper_file:
          type: array
          title: "Paper file"
          items: 
            $ref: "#/components/schemas/PaperFile"
        geometry:
          type: array
          title: "Geometry"
          items: 
            $ref: "#/components/schemas/Geometry"
        subType:
          title: "Activity subtype"
          oneOf:
            - $ref: "#/components/schemas/Observation"
              title: "Observation"
            - $ref: "#/components/schemas/Treatment"
              title: "Treatment"
            - $ref: "#/components/schemas/Monitoring"
              title: "Monitoring"

    Observation:
      description: |
        Observation main object.
      type: object
      required:
        - observation_date
        - observation time
        - observation_type
        - observer_first_name
        - observer_last_name
        - reported_area
        - sample_taken
        - negative_obs_ind
        - subType
      properties:
        observation_date:
          type: string
          title: "Date"
        observation_time:
          type: string
          title: "Time"
        observation_type:
          type: string
          title: "Type"
        observer_first_name:
          type: string
          title: "First Name"
          maximum: 50
        observer_last_name:
          type: string
          title: "Last Name"
          maximum: 50
        reported_area:
          type: integer
          title: "Area"
          minimum: 1
          maximum: 100
        sample_taken:
          type: boolean
          title: "Sample Taken"
        sample_number:
          type: string
          title: "Sample Number"
          maximum: 50
        negative_obs_ind:
          type: boolean
          title: "Negative Observation"
        subType:
          title: "Observation subtype"
          oneOf:
            - $ref: "#/components/schemas/Observation_PlantTerrestial"
              title: "Terrestrial Plant Observation"
            - $ref: "#/components/schemas/Observation_PlantAquatic"
              title: "Aquatic Plant Observation"
            - $ref: "#/components/schemas/Observation_AnimalTerrestrial"
              title: "Terrestrial Animal Observation"
            - $ref: "#/components/schemas/Observation_AnimalAquatic"
              title: "Aquatic Animal Observation"
            

    Observation_PlantTerrestial:
      description: |
        Plant Observation Terrestrial
      type: object
      required:
        - species_density_code
        - species_distribution_code
        - soil_texture_code
        - specific_use_code
        - slope_code
        - aspect_code
        - proposed_action_code
        - flowering
        - plant_life_stage
        - plant_health
        - plant_seed_stage
        - legacy_site_ind
        - early_detection_rapid_resp_ind
        - research_detection_ind
        - well_ind
        - special_care_ind
        - biological_ind
      properties:
        species_density_code:
          type: string
          title: "Density"
        species_distribution_code:
          type: string
          title: "Distribution"
        soil_texture_code:
          type: string
          title: "Soil Texture"
        specific_use_code:
          type: string
          title: "Specific Use"
        slope_code:
          type: string
          title: "Slope"
        aspect_code:
          type: string
          title: "Aspect"
        proposed_action_code:
          type: string
          title: "Proposed Action"
        flowering:
          type: boolean
          title: "Flowering"
        plant_life_stage:
          type: string
          title: "Life Stage"
        plant_health:
          type: string
          title: "Health"
        plant_seed_stage:
          type: string
          title: "Seed Stage"
        sample_identifier:
          type: string
          title: "Sample ID"
        range_unit_number:
          type: string
          title: "Range Unit"
        legacy_site_ind:
          type: boolean
          title: "Legacy site"
        early_detection_rapid_resp_ind:
          type: boolean
          title: "Early Detection"
        research_detection_ind:
          type: boolean
          title: "Research Detection"
        well_ind:
          type: boolean
          title: "Visible well nearby"
        special_care_ind:
          type: boolean
          title: "Special Care"
        biological_ind:
          type: boolean
          title: "Biological"
    Observation_PlantAquatic:
      description:
        Plant Observation Terrestrial
      type: object
      required:
        - specific_use_code
        - proposed_action_code
        - flowering
        - plant_life_stage
        - plant_health
        - plant_seed_stage
        - legacy_site_ind
        - early_detection_rapid_resp_ind
        - research_detection_ind
        - sample_taken
        - special_care_ind
        - biological_ind
        - secchi_depth
        - water_depth
        - voucher_submitted_ind
      properties:
        specific_use_code:
          type: string
          title: "Specific Use"
        proposed_action_code:
          type: string
          title: "Proposed Action"
        flowering:
          type: boolean
          title: "Flowering"
        plant_life_stage:
          type: string
          title: "Life Stage"
        plant_health:
          type: string
          title: "Health"
        plant_seed_stage:
          type: string
          title: "Seed Stage"
        sample_identifier:
          type: string
          title: "Sample ID"
        range_unit_number:
          type: string
          title: "Range Unit"
        legacy_site_ind:
          type: boolean
        early_detection_rapid_resp_ind:
          type: boolean
          title: "Early Detection"
        research_detection_ind:
          type: boolean
          title: "Research Detection"
        sample_taken:
          type: boolean
          title: "Sample Taken"
        sample_point_number:
          type: string
          title: "Sample Number"
        special_care_ind:
          type: boolean
          title: "Special Care"
        biological_ind:
          type: boolean
          title: "Biological"
        secchi_depth:
          type: number
          format: float
          title: "secchi depth"
        water_depth:
          type: number
          format: float
          title: "water depth"
        voucher_submitted_ind:
          type: boolean
          title: "Voucher submitted"
        voucher_submission_detail:
          type: string
          title: "Voucher submission details"
        

    Observation_AnimalTerrestrial:
      description: |
        Animal Observation Terrestrial.
      type: object
      required:
        - number_of_individuals_observed
        - life_stage
        - behaviour
      properties:
        number_of_individuals_observed:
          type: number
          title: "Number of individuals"
        life_stage:
          type: string
          title: "Life Stage"
          enum:
            - unknown
            - egg
            - neonate
            - juvenile
            - adult
        behaviour:
          type: string
          title: "Behaviour"
          enum:
            - unknown
            - moving 
            - resting
            - deceased
    
    Observation_AnimalAquatic:
      description: |
        Animal Observation Aquatic.
      type: object
      required: 
        - observation_details
      properties:
        observation_details:
          type: string
          title: "Aquatic animal observations"
    Treatment:
      description: |
        Treament main object.
      type: object
      required:
        -subType
      properties:
        subType:
          title: "Treatment type"
          oneOf:
            - $ref: "#/components/schemas/Treatment_ChemicalPlant"
              title: "Chemical treatment for plants"
            - $ref: "#/components/schemas/Treatment_MechanicalPlant"
              title: "Mechanical treatment for plants"
            - $ref: "#/components/schemas/Treatment_BiologicalPlant"
              title: "Biological treament for plants"
            - $ref: "#/components/schemas/Treatment_BiologicalDispersalPlant"
              title: "Biological dispersal treament for plants"
            - $ref: "#/components/schemas/Treatment_MechanicalTerrestrialAnimal"
              title: "Mechanical treatment for terrestrial animals"
            - $ref: "#/components/schemas/Treatment_ChemicalTerrestrialAnimal"
              title: "Chemical treatment for terrestrial animals"
            - $ref: "#/components/schemas/Treatment_BiologicalTerrestrialAnimal"
              title: "Biological treatment for terrestrial animals"
  
    Treatment_ChemicalPlant:
      description: |
        Chemical treament for plants - main object.
      type: object
      required:
        - primary_applicator_employee_code
        - secondary_applicator_employee_code
        - pesticide_employer_code
        - project_management_plan_PMP
        - chemical_treatment_method
        - temperature
        - humidity
        - mix_delivery_rate
        - application_rate
        - area_treated
        - herbicide
      properties:
        primary_applicator_employee_code:
          type: string
          title: "Primary Applicator employee code"
        secondary_applicator_employee_code:
          type: string
          title: "Secondary Applicator employee code"
        pesticide_employer_code:
          type: string
          title: "Pesticide employer code"
        project_management_plan_PMP:
          type: string
          title: "Project Management Plan"
        pesticide_use_permit_PUP:
          type: string
          title: "Pesticide use permit"
        chemical_treatment_method:
          type: string
          title: "Chemical treatment method"
        temperature:
          type: integer
          title: "Temperature"
          minimum: 10
          maximum: 30
        wind_speed:
          type: integer
          title: " Wind speed"
        wind_direction:
          type: string
          title: "Wind direction"
          enum:
            - N
            - NE
            - E
            - SE
            - S
            - SW
            - W
            - NW
        humidity:
          type: integer
          title: "Humidity"
          enum: 
            - 0
            - 10
            - 20
            - 30
            - 40
            - 50
            - 60
            - 70
            - 80
            - 90
            - 100
        mix_delivery_rate:
          type: number
          format: float
          title: "Mix delivery rate"
        application_rate:
          type: number
          format: float
          title: "Application rate"
        area_treated:
          type: number
          format: float
          title: "Area treated"
        herbicide:
          type: array
          title: "Herbicide"
          items: 
            $ref: "#/components/schemas/Herbicide"

    Treatment_MechanicalPlant:
      description:
        Mechanical treament for plants - main object.
      type: object
      required:
        - applicator1_first_name
        - applicator1_last_name
        - treatment_contractor
        - mechanical_method
        - mechanical_disposal_method
        - mechanical_root_removal_code
        - mechanical_soil_disturbance_code
        - signage_on_site
      properties:
        applicator1_first_name:
          type: string
          title: "Applicator 1 first name"
        applicator1_last_name:
          type: string
          title: "Applicator 1 last name"
        applicator2_first_name:
          type: string
          title: "Applicator 1 first name"
        applicator2_last_name:
          type: string
          title: "Applicator 1 last name"
        treatment_contractor:
          type: string
          title: "Treatment contractor"
        mechanical_method:
          type: string
          title: "Mechanical method"
        mechanical_disposal_method:
          type: string
          title: "Mechanical disposal method"
        mechanical_root_removal_code:
          type: string
          title: "Mechanical root removal code"
        mechanical_soil_disturbance_code:
          type: string
          title: "Mechanical soil disturbance code"
        signage_on_site:
          type: boolean
          title: "Signage on site"
    Treatment_BiologicalPlant:
      description:
        Biological treament for plants - main object.
      type: object
      required:
        - applicator1_first_name
        - applicator1_last_name
        - treatment_contractor
        - classified_area
        - release_quantity
        - agent_source
        - biological_agent
        - biological_agent_stage
        - bioagent_maturity_status
      properties:
        applicator1_first_name:
          type: string
          title: "Applicator 1 first name"
        applicator1_last_name:
          type: string
          title: "Applicator 1 last name"
        applicator2_first_name:
          type: string
          title: "Applicator 1 first name"
        applicator2_last_name:
          type: string
          title: "Applicator 1 last name"
        treatment_contractor:
          type: string
          title: "Treatment contractor"
        classified_area:
          type: string
          title: "Classified area"
        release_quantity:
          type: integer
          title: "Release quantity"
        agent_source:
          type: string
          title: "Agent source"
        biological_agent:
          type: string
          title: "Biological agent"
        biological_agent_stage:
          type: string
          title: "Biological agent stage"
        bioagent_maturity_status:
          type: string
          title: "Bioagent maturity status"

    Treatment_BiologicalDispersalPlant:
      description:
        Mechanical treament for plants - main object.
      type: object
      required:
        - applicator1_first_name
        - applicator1_last_name
        - treatment_contractor
        - duration_of_count
        - biological_agent
        - plant_count
        - biological_agent_count
        - biological_agent_presence
      properties:
        applicator1_first_name:
          type: string
          title: "Applicator 1 first name"
        applicator1_last_name:
          type: string
          title: "Applicator 1 last name"
        applicator2_first_name:
          type: string
          title: "Applicator 2 first name"
        applicator2_last_name:
          type: string
          title: "Applicator 2 last name"
        treatment_contractor:
          type: string
          title: "Treatment contractor"
        duration_of_count:
          type: integer
          title: "Duration of count"
        biological_agent:
          type: string
          title: "Biological agent"
        plant_count:
          type: integer
          title: "Plant count"
        biological_agent_count:
          type: integer
          title: "Biological agent count"
        biological_agent_presence:
          type: string
          title: "Biological agent presence"

    Treatment_MechanicalTerrestrialAnimal:
      description:
        Mechanical treament for terrestrial animals - main object.
      type: object
      required:
        - treatment_details
      properties:
        treatment_details:
          type: string
          title: "Treatment details"

    Treatment_ChemicalTerrestrialAnimal:
      description:
        Chemical treament for terrestrial animals - main object.
      type: object
      required:
        - treatment_details
      properties:
        treatment_details:
          type: string
          title: "Treatment details"
    
    Treatment_BiologicalTerrestrialAnimal:
      description:
        Biological treament for terrestrial animals - main object.
      type: object
      required:
        - treatment_details
      properties:
        treatment_details:
          type: string
          title: "Treatment details"

    Monitoring:
      description: |
        Monitoring main object.
      type: object
      required:
        - activity_id
        - observer_first_name
        - observer_last_name
        - efficacy_rating_code
      properties:
        activity_id:
          type: integer
          title: "Treatment id"
        observer_first_name:
          type: string
          title: "First Name"
        observer_last_name:
          type: string
          title: "Last Name"
        efficacy_rating_code:
          type: integer
          title: "Efficacy rating"
          enum:
            - 0
            - 5
            - 10
            - 15
            - 20
            - 25
            - 30
            - 35
            - 40
            - 45
            - 50
            - 55
            - 60
            - 65
            - 70
            - 75
            - 80
            - 85
            - 90
            - 95
            - 100
        subType:
          title: "Monitoring type"
          oneOf:
            - $ref: "#/components/schemas/Monitoring_ChemicalTerrestrialAquaticPlant"
              title: " Monitoring a chemical treament for terrestrial and aquatic plants"
            - $ref: "#/components/schemas/Monitoring_MechanicalTerrestrialAquaticPlant"
              title: "Monotoring a mechanical treatment for terrestrial and aquatic plants"
            - $ref: "#/components/schemas/Monitoring_BiologicalTerrestrialPlant"
              title: "Monitoring a biological treatment for terrestrial plants"
            - $ref: "#/components/schemas/Monitoring_MechanicalTerrestrialAnimal"
              title: "Monotoring a mechanical treatment for a terrestrial animal"
            - $ref: "#/components/schemas/Monitoring_ChemicalTerrestrialAnimal"
              title: "Monitoring a chemical treatment for a terrestrial animal"
            - $ref: "#/components/schemas/Monitoring_BiologicalTerrestrialAnimal"
              title: "Monitoring a biological treatment for a terrestrial animal"
      
    Monitoring_ChemicalTerrestrialAquaticPlant:
      description:
        Chemical monitoring for terrestrial plants - main object.
      type: object
      required:
        - monitoring_details
      properties:
        monitoring_details:
          type: string
          title: "Monitoring details"

    Monitoring_MechanicalTerrestrialAquaticPlant:
      description:
        Mechanical monitoring for terrestrial plants - main object.
      type: object
      required:
        - monitoring_details
      properties:
        monitoring_details:
          type: string
          title: "Monitoring details"

    Monitoring_BiologicalTerrestrialPlant:
      description:
        Biological monitoring for terrestrial plants - main object.
      type: object
      required: 
      - plant_count
      - agent_count
      - count_duration
      - agent_destroyed_ind
      - legacy_presence_ind
      - foliar_feeding_damage_ind
      - root_feeding_damage_ind
      - oviposition_marks_ind
      - eggs_present_ind
      - larvae_present_ind
      - pupae_present_ind
      - adults_present_ind
      - tunnels_present_ind
      properties:
        plant_count:
          type: integer
          title: "Plant count"
        agent_count:
          type: integer
          title: "Agent count"
        count_duration:
          type: integer
          title: "Count duration"
        agent_destroyed_ind:
          type: boolean
          title: "Agent destroyed"
        legacy_presence_ind:
          type: boolean
          title: "Legacy presence"
        foliar_feeding_damage_ind:
          type: boolean
          title: "Foliar feeding damage"
        root_feeding_damage_ind:
          type: boolean
          title: "Root feeding damage"
        oviposition_marks_ind:
          type: boolean
          title: "Oviposition marks"
        eggs_present_ind:
          type: boolean
          title: "Eggs present"
        larvae_present_ind:
          type: boolean
          title: "Larvae present"
        pupae_present_ind:
          type: boolean
          title: "Pupae present"
        adults_present_ind:
          type: boolean
          title: "Adults present"
        tunnels_present_ind:
          type: boolean
          title: "Tunnels present"
        biological_agent_spread:
          type: string
          title: "Biological agent spread"

    Monitoring_MechanicalTerrestrialAnimal:
      description:
        Mechanical monitoring for terrestrial plants - main object.
      type: object
      required:
        - monitoring_details
      properties:
        monitoring_details:
          type: string
          title: "Monitoring details"

    Monitoring_ChemicalTerrestrialAnimal:
      description:
        Chemical monitoring for terrestrial plants - main object.
      type: object
      required:
        - monitoring_details
      properties:
        monitoring_details:
          type: string
          title: "Monitoring details"

    Monitoring_BiologicalTerrestrialAnimal:
      description:
        Biological monitoring for terrestrial plants - main object.
      type: object
      required:
        - monitoring_details
      properties:
        monitoring_details:
          type: string
          title: "Monitoring details"

    Media:
      description: |
        List of Media
      type: object
      properties:
        media_date:
          type: string
          title: "Date"
        description:
          type: string
          title: "Description"
        file_name: 
          type: 'string'
          title: 'File Name'
        encoded_file:
          type: 'string'
          format: 'base64'
          description: 'A Data URL base64 encoded image'
          example: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEBLAEsAAD/4REy...'

    PaperFile:
      description: |
        Paper files
      type: object
      required:
        - description
      properties:
        description:
          type: string
          title: "Description"
          maximum: 50
    
    Herbicide:
      description:
        herbicide
      type: object
      required:
        - herbicide_name
        - herbicide_amount
      properties:
        herbicide_name:
          type: string
          title: "herbicide name"
        herbicide_amount:
          type: number
          title: "herbicide amount"
          format: float

    Geometry:
      type: object
      description: GeoJSon geometry
      discriminator:
        propertyName: type
      required:
        - type
      externalDocs:
        url: http://geojson.org/geojson-spec.html#geometry-objects
      properties:
        type:
          type: string
          enum:
            - Point
            - LineString
            - Polygon
          description: the geometry type
        elevation_metres:
          type: integer
          title: "Elevation (m)"
        well_proximity:
          type: number
          format: float
          title: "Well proximity"
        well_tag:
          type: integer
          title: "Well tag"

    Point3D:
      type: array
      description: Point in 3D space
      externalDocs:
        url: http://geojson.org/geojson-spec.html#id2
      minItems: 2
      maxItems: 3
      items:
        type: number
    ## point needs a radius
    Point:
      type: object
      description: GeoJSon geometry
      externalDocs:
        url: http://geojson.org/geojson-spec.html#id2
      allOf:
        - $ref: "#/components/schemas/Geometry"
        - properties:
            coordinates:
              $ref: "#/components/schemas/Point3D"
    LineString:
      type: object
      description: GeoJSon geometry
      externalDocs:
        url: http://geojson.org/geojson-spec.html#id3
      allOf:
        - $ref: "#/components/schemas/Geometry"
        - properties:
            coordinates:
              type: array
              items:
                $ref: "#/components/schemas/Point3D"
    Polygon:
      type: object
      description: GeoJSon geometry
      externalDocs:
        url: http://geojson.org/geojson-spec.html#id4
      allOf:
        - $ref: "#/components/schemas/Geometry"
        - properties:
            coordinates:
              type: array
              items:
                type: array
                items:
                  $ref: "#/components/schemas/Point3D"
    
  

## Questions:
## - If area treated comes for the geometry, does the user need that information at the time of the activity?  otherwise can we do the calculation in the back-end?
## - we need the full spec for the point 3D
## - how do we treat the waypoint offset? and box polygon?
## - do we still need hex_id, hex_sub_id?
##

    